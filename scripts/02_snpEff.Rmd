---
title: "SNPeff"
output: html_notebook
---

This documents using [SNPeff](https://pcingola.github.io/SnpEff/) to annotate SNPs in TanOak with their functional consequences.

## Install SNPeff

```{bash, eval=FALSE}
cd /usr/local/bin
wget https://snpeff.blob.core.windows.net/versions/snpEff_latest_core.zip
unzip snpEff_latest_core.zip
cp -s snpEff/snpEff.jar
```


### Number of genes

```{bash}
cd "/Volumes/GoogleDrive/Shared drives/TanOak/new_12_2021_assembly"
echo "gene: " $(grep -c "\sgene\s" v4draft.maker.repeatlib.noseq.gff)

echo "CDS: " $(grep -c "\sCDS\s" v4draft.maker.repeatlib.noseq.gff)

echo "mRNA: " $(grep -c "\smRNA\s" v4draft.maker.repeatlib.noseq.gff)
```


```{bash}
cd "/Volumes/GoogleDrive/Shared drives/TanOak/new_12_2021_assembly"
echo "gene: " $(grep -c "\sgene\s" 12_21_tanoak_gene.gff)

echo "CDS: " $(grep -c "\sCDS\s" 12_21_tanoak_cds.gff)
```

## build genome index

set up directories and update snpEff.config file
```{bash, eval=FALSE}
echo "tanoak.v1221.genome : Tanoak" >> /usr/local/bin/snpEff/snpEff.config

mkdir /usr/local/bin/snpEff/data
mkdir /usr/local/bin/snpEff/data/tanoak.v1221
```


```{bash, eval=FALSE}
cd /usr/local/bin/snpEff/data/tanoak.v1221

gzip -c /Volumes/GoogleDrive/Shared\ drives/TanOak/new_12_2021_assembly/PanGenome_ONT_pilon.purge.dedup90.drop2k.mergeN.fasta > tanoak.v1221.fa.gz

gzip -c /Volumes/GoogleDrive/Shared\ drives/TanOak/new_12_2021_assembly/v4draft.maker.repeatlib.noseq.gff > genes.gff.gz

cd /usr/local/bin/snpEff
java -jar snpEff.jar build -gff3 -v tanoak.v1221
```


check it
```{bash, eval=FALSE}
cd /usr/local/bin/snpEff
java -jar snpEff.jar dump   tanoak.v1221  | head -n 40
```

## run annotation

```{bash, eval=FALSE}
cd ~/git/TanOak/output

time java -Xmx8g -jar /usr/local/bin/snpEff.jar tanoak.v1221 /Volumes/GoogleDrive/Shared\ drives/TanOak/new_12_2021_assembly/cohort.genotyped.vcf.gz > /Volumes/GoogleDrive/Shared\ drives/TanOak/new_12_2021_assembly/cohort.genotyped.snpEff.vcf

gzip /Volumes/GoogleDrive/Shared\ drives/TanOak/new_12_2021_assembly/cohort.genotyped.snpEff.vcf

ln -s /Volumes/GoogleDrive/Shared\ drives/TanOak/new_12_2021_assembly/cohort.genotyped.snpEff.vcf.gz ./

```



